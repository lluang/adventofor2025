---
title: "Task 2: Portfolio Metrics"
output: html_document
---

This document calculates key portfolio metrics based on the provided data.

## 1. Load Data

We load the `segments.csv` file which contains the exposure and risk weight for each segment.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
```

```{r load-data}
segments <- read_csv("../data/segments.csv")
```

## 2. Calculate Portfolio Metrics

### Total Portfolio Exposure

The total portfolio exposure is the sum of exposures of all segments.

```{r total-exposure}
total_exposure <- sum(segments$exposure)
```

Total Portfolio Exposure: **`r scales::dollar(total_exposure)`**

### Current Weighted-Average Risk Weight

The weighted-average risk weight is calculated by weighting each segment's risk weight by its exposure.

The formula is: $$ \frac{\sum(\text{exposure} \times \text{risk\_weight})}{\sum(\text{exposure})} $$

```{r weighted-avg-risk-weight}
weighted_average_risk_weight <- sum(segments$exposure * segments$risk_weight) / total_exposure
```

Current Weighted-Average Risk Weight: **`r round(weighted_average_risk_weight, 4)`**

### Regulatory Constraint

We need to check if the 50% regulatory constraint is already binding. Assuming this constraint applies to the weighted-average risk weight.

```{r regulatory-constraint}
is_binding <- weighted_average_risk_weight >= 0.5
```

The weighted-average risk weight is `r round(weighted_average_risk_weight, 4)`, which is `r ifelse(is_binding, "greater than or equal to", "less than")` 0.5.

Conclusion: **`r ifelse(is_binding, "The 50% regulatory constraint is binding.", "The 50% regulatory constraint is not binding.")`**

This completes the calculation of the current portfolio metrics.
I will create another Rmd file for Task 3.
